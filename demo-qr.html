<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Demo - Sistema QR Code OS</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        
        .demo-container {
            background: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
        }
        
        h2 {
            color: #34495e;
            border-left: 4px solid #3498db;
            padding-left: 15px;
            margin-top: 30px;
        }
        
        .example-section {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 5px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .payload-example {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            overflow-x: auto;
            white-space: pre-wrap;
        }
        
        .payload-valid {
            border-left: 4px solid #27ae60;
        }
        
        .payload-invalid {
            border-left: 4px solid #e74c3c;
        }
        
        .btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px;
            transition: background 0.3s;
        }
        
        .btn:hover {
            background: #2980b9;
        }
        
        .btn-success { background: #27ae60; }
        .btn-success:hover { background: #219a52; }
        
        .btn-warning { background: #f39c12; }
        .btn-warning:hover { background: #d68910; }
        
        .btn-danger { background: #e74c3c; }
        .btn-danger:hover { background: #c0392b; }
        
        .demo-input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            height: 100px;
            margin: 10px 0;
        }
        
        .result-box {
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
            display: none;
        }
        
        .result-success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        
        .result-error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .stat-card {
            background: #3498db;
            color: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
        }
        
        .stat-number {
            font-size: 36px;
            font-weight: bold;
            margin: 10px 0;
        }
        
        .flow-diagram {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        
        .flow-step {
            background: rgba(255,255,255,0.1);
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            border-left: 4px solid rgba(255,255,255,0.5);
        }
        
        .api-endpoint {
            background: #34495e;
            color: #ecf0f1;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            margin: 10px 0;
        }
        
        .qr-demo-area {
            text-align: center;
            background: #f8f9fa;
            padding: 20px;
            border-radius: 5px;
            border: 2px dashed #6c757d;
        }
        
        #qr-display {
            margin: 20px 0;
        }
        
        .feature-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .feature-card {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 20px;
            border-radius: 8px;
        }
        
        .feature-card h3 {
            margin-top: 0;
        }
        
        .code-tabs {
            display: flex;
            margin-bottom: -1px;
        }
        
        .code-tab {
            background: #6c757d;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px 5px 0 0;
            cursor: pointer;
            margin-right: 2px;
        }
        
        .code-tab.active {
            background: #2c3e50;
        }
        
        .code-content {
            display: none;
        }
        
        .code-content.active {
            display: block;
        }
    </style>
</head>
<body>
    <div class="demo-container">
        <h1>üöÄ Sistema de OS com QR Code - Demonstra√ß√£o Interativa</h1>
        
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-number" id="demo-atendimentos">12</div>
                <div>Atendimentos Ativos</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="demo-os-pending">8</div>
                <div>OS Pendentes</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="demo-os-signed">5</div>
                <div>OS Assinadas</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="demo-os-finalized">23</div>
                <div>OS Finalizadas</div>
            </div>
        </div>
    </div>

    <div class="demo-container">
        <h2>üîÑ Fluxo Completo do Sistema</h2>
        
        <div class="flow-diagram">
            <h3>Processo Passo a Passo</h3>
            <div class="flow-step">
                <strong>1. Cliente solicita servi√ßo</strong><br>
                T√©cnico cria atendimento no sistema com dados do cliente
            </div>
            <div class="flow-step">
                <strong>2. Atendimento ‚Üí Ordem de Servi√ßo</strong><br>
                Ap√≥s diagn√≥stico, atendimento vira OS com descri√ß√£o detalhada
            </div>
            <div class="flow-step">
                <strong>3. Execu√ß√£o do Servi√ßo</strong><br>
                T√©cnico realiza o reparo/servi√ßo conforme descrito na OS
            </div>
            <div class="flow-step">
                <strong>4. Assinatura Digital</strong><br>
                Cliente assina digitalmente confirmando a execu√ß√£o
            </div>
            <div class="flow-step">
                <strong>5. Finaliza√ß√£o</strong><br>
                OS √© finalizada e arquivada para controle e relat√≥rios
            </div>
        </div>
    </div>

    <div class="demo-container">
        <h2>üîê Demonstra√ß√£o QR Code</h2>
        
        <div class="feature-list">
            <div class="feature-card">
                <h3>üéØ QR Code para Edi√ß√£o</h3>
                <p>Permite edi√ß√£o r√°pida dos dados do cliente existente</p>
                <button class="btn btn-success" onclick="generateDemoQR('edit')">Gerar QR Edi√ß√£o</button>
            </div>
            <div class="feature-card">
                <h3>üìù QR Code para Registro</h3>
                <p>Facilita cadastro de novo cliente no sistema</p>
                <button class="btn btn-warning" onclick="generateDemoQR('register')">Gerar QR Registro</button>
            </div>
        </div>
        
        <div class="qr-demo-area">
            <h3>QR Code Gerado</h3>
            <div id="qr-display">
                <p>Clique em um dos bot√µes acima para gerar um QR Code de demonstra√ß√£o</p>
            </div>
            <div id="qr-token-display" style="display: none;">
                <h4>Token para Teste:</h4>
                <textarea id="qr-token-area" class="demo-input" readonly></textarea>
                <button class="btn" onclick="copyToClipboard()">üìã Copiar Token</button>
            </div>
        </div>
    </div>

    <div class="demo-container">
        <h2>üß™ Valida√ß√£o de QR Code</h2>
        
        <div class="example-section">
            <h3>Cole um token QR para validar:</h3>
            <textarea id="qr-input" class="demo-input" placeholder="Cole aqui o token do QR Code..."></textarea>
            <button class="btn" onclick="validateQRDemo()">Validar QR Code</button>
            
            <div id="validation-result" class="result-box"></div>
        </div>
        
        <h3>Exemplos de Payloads</h3>
        
        <div class="code-tabs">
            <button class="code-tab active" onclick="showTab('valid-examples')">‚úÖ Exemplos V√°lidos</button>
            <button class="code-tab" onclick="showTab('invalid-examples')">‚ùå Exemplos Inv√°lidos</button>
            <button class="code-tab" onclick="showTab('api-examples')">üì° Exemplos de API</button>
        </div>
        
        <div id="valid-examples" class="code-content active">
            <div class="example-section">
                <h4>QR Code para Editar Cliente</h4>
                <div class="payload-example payload-valid">{
  "payload": {
    "clientId": "123e4567-e89b-12d3-a456-426614174000",
    "action": "edit",
    "exp": 1736694000,
    "iat": 1736690400
  },
  "signature": "a1b2c3d4e5f6g7h8i9j0"
}</div>
                <button class="btn btn-success" onclick="useExample('edit')">Testar este exemplo</button>
            </div>
            
            <div class="example-section">
                <h4>QR Code para Registrar Cliente</h4>
                <div class="payload-example payload-valid">{
  "payload": {
    "clientId": "new-client-uuid",
    "action": "register", 
    "exp": 1736694000,
    "iat": 1736690400
  },
  "signature": "x1y2z3w4v5u6t7s8r9q0"
}</div>
                <button class="btn btn-success" onclick="useExample('register')">Testar este exemplo</button>
            </div>
        </div>
        
        <div id="invalid-examples" class="code-content">
            <div class="example-section">
                <h4>Token Expirado</h4>
                <div class="payload-example payload-invalid">{
  "payload": {
    "clientId": "123e4567-e89b-12d3-a456-426614174000",
    "action": "edit",
    "exp": 1636694000, // ‚Üê Expirado!
    "iat": 1636690400
  },
  "signature": "expired_signature"
}</div>
                <p><strong>Erro esperado:</strong> "Token expirado"</p>
            </div>
            
            <div class="example-section">
                <h4>A√ß√£o Inv√°lida</h4>
                <div class="payload-example payload-invalid">{
  "payload": {
    "clientId": "123e4567-e89b-12d3-a456-426614174000",
    "action": "invalid_action", // ‚Üê A√ß√£o inv√°lida!
    "exp": 1736694000,
    "iat": 1736690400
  },
  "signature": "valid_signature"
}</div>
                <p><strong>Erro esperado:</strong> "A√ß√£o deve ser 'edit' ou 'register'"</p>
            </div>
            
            <div class="example-section">
                <h4>Token Malformado</h4>
                <div class="payload-example payload-invalid">token-malformado-sem-base64-v√°lido</div>
                <p><strong>Erro esperado:</strong> "Token malformado"</p>
            </div>
        </div>
        
        <div id="api-examples" class="code-content">
            <div class="example-section">
                <h4>Gerar QR Code</h4>
                <div class="api-endpoint">POST /api/qr/generate
Authorization: Bearer {token}
Content-Type: application/json

{
  "clientId": "123e4567-e89b-12d3-a456-426614174000",
  "action": "edit"
}

‚Üí Response:
{
  "token": "base64-encoded-signed-payload",
  "qrData": "base64-encoded-signed-payload",
  "expiresAt": "2025-01-12T15:30:00.000Z"
}</div>
            </div>
            
            <div class="example-section">
                <h4>Validar QR Code</h4>
                <div class="api-endpoint">POST /api/qr/validate
Authorization: Bearer {token}
Content-Type: application/json

{
  "token": "base64-encoded-signed-payload"
}

‚Üí Response (Sucesso):
{
  "valid": true,
  "payload": {
    "clientId": "123e4567-e89b-12d3-a456-426614174000",
    "action": "edit",
    "exp": 1736694000,
    "iat": 1736690400
  },
  "client": {
    "id": "123e4567-e89b-12d3-a456-426614174000",
    "name": "Jo√£o Silva",
    "phone": "11999999999",
    "email": "joao@email.com"
  }
}</div>
            </div>
            
            <div class="example-section">
                <h4>Criar Atendimento</h4>
                <div class="api-endpoint">POST /api/atendimentos
Authorization: Bearer {token}
Content-Type: application/json

{
  "clientId": "123e4567-e89b-12d3-a456-426614174000",
  "summary": "Reparo de smartphone com tela quebrada",
  "priority": "alta",
  "status": "aguardando"
}

‚Üí Response:
{
  "id": "atendimento-uuid",
  "clientId": "123e4567-e89b-12d3-a456-426614174000",
  "summary": "Reparo de smartphone com tela quebrada",
  "priority": "alta",
  "status": "aguardando",
  "createdAt": "2025-01-12T14:30:00.000Z",
  "client": {
    "id": "123e4567-e89b-12d3-a456-426614174000",
    "name": "Jo√£o Silva",
    "phone": "11999999999"
  }
}</div>
            </div>
        </div>
    </div>

    <div class="demo-container">
        <h2>‚ö° Funcionalidades Principais</h2>
        
        <div class="feature-list">
            <div class="feature-card">
                <h3>üë• Gest√£o de Clientes</h3>
                <ul>
                    <li>CRUD completo</li>
                    <li>Valida√ß√£o de dados</li>
                    <li>Integra√ß√£o com QR</li>
                    <li>Hist√≥rico de atendimentos</li>
                </ul>
            </div>
            
            <div class="feature-card">
                <h3>üìã Lista de Atendimentos</h3>
                <ul>
                    <li>Filtros por status</li>
                    <li>Ordena√ß√£o por prioridade</li>
                    <li>Busca por cliente</li>
                    <li>Convers√£o para OS</li>
                </ul>
            </div>
            
            <div class="feature-card">
                <h3>üìù Ordens de Servi√ßo</h3>
                <ul>
                    <li>Fluxo: Pendente ‚Üí Assinada ‚Üí Finalizada</li>
                    <li>Assinatura digital</li>
                    <li>Controle por t√©cnico</li>
                    <li>Relat√≥rios autom√°ticos</li>
                </ul>
            </div>
            
            <div class="feature-card">
                <h3>üîê Seguran√ßa QR</h3>
                <ul>
                    <li>Payload assinado HMAC</li>
                    <li>Expira√ß√£o autom√°tica</li>
                    <li>Valida√ß√£o de integridade</li>
                    <li>Autentica√ß√£o JWT</li>
                </ul>
            </div>
        </div>
    </div>

    <div class="demo-container">
        <h2>üöÄ Como Usar o Sistema</h2>
        
        <div class="example-section">
            <h3>1. Executar o Backend</h3>
            <div class="api-endpoint">cd api
npm install
npm run dev

# Servidor rodar√° em http://localhost:3000</div>
        </div>
        
        <div class="example-section">
            <h3>2. Abrir o Dashboard</h3>
            <p>Abra o arquivo <code>os-dashboard.html</code> em seu navegador.</p>
        </div>
        
        <div class="example-section">
            <h3>3. Fazer Login</h3>
            <div class="api-endpoint">Email: admin@example.com
Senha: admin123</div>
        </div>
        
        <div class="example-section">
            <h3>4. Criar Atendimento</h3>
            <p>Clique em "+ Novo Atendimento" e preencha os dados do cliente e servi√ßo.</p>
        </div>
        
        <div class="example-section">
            <h3>5. Gerar QR Code</h3>
            <p>Clique no bot√£o "QR" ao lado de um atendimento para gerar o c√≥digo QR.</p>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcode/1.5.3/qrcode.min.js"></script>
    <script>
        // Simula√ß√£o de dados para demonstra√ß√£o
        const mockClient = {
            id: "123e4567-e89b-12d3-a456-426614174000",
            name: "Jo√£o Silva",
            phone: "11999999999",
            email: "joao@email.com",
            address: "Rua das Flores, 123"
        };
        
        function generateDemoQR(action) {
            const payload = {
                clientId: action === 'edit' ? mockClient.id : 'new-client-uuid',
                action: action,
                exp: Math.floor(Date.now() / 1000) + 3600, // Expira em 1 hora
                iat: Math.floor(Date.now() / 1000)
            };
            
            // Simular assinatura (em produ√ß√£o seria HMAC real)
            const signature = 'demo_signature_' + Math.random().toString(36).substring(7);
            
            const tokenData = {
                payload: payload,
                signature: signature
            };
            
            const token = btoa(JSON.stringify(tokenData));
            
            // Exibir QR Code
            const qrDisplay = document.getElementById('qr-display');
            qrDisplay.innerHTML = '<div id="qr-code"></div>';
            
            QRCode.toCanvas(document.getElementById('qr-code'), token, {
                width: 200,
                height: 200
            }, function (error) {
                if (error) console.error(error);
            });
            
            // Exibir token
            document.getElementById('qr-token-area').value = token;
            document.getElementById('qr-token-display').style.display = 'block';
            
            // Adicionar informa√ß√µes do QR
            const info = document.createElement('div');
            info.innerHTML = `
                <h4>Informa√ß√µes do QR Code</h4>
                <p><strong>A√ß√£o:</strong> ${action === 'edit' ? 'Editar Cliente' : 'Registrar Cliente'}</p>
                <p><strong>Cliente ID:</strong> ${payload.clientId}</p>
                <p><strong>Expira em:</strong> ${new Date(payload.exp * 1000).toLocaleString('pt-BR')}</p>
            `;
            info.style.background = '#e3f2fd';
            info.style.padding = '15px';
            info.style.borderRadius = '5px';
            info.style.marginTop = '15px';
            
            qrDisplay.appendChild(info);
        }
        
        function validateQRDemo() {
            const input = document.getElementById('qr-input');
            const resultDiv = document.getElementById('validation-result');
            const token = input.value.trim();
            
            if (!token) {
                showResult('Por favor, cole um token QR primeiro.', 'error');
                return;
            }
            
            try {
                // Tentar decodificar o token
                const tokenData = JSON.parse(atob(token));
                const payload = tokenData.payload;
                
                // Valida√ß√µes b√°sicas
                if (!payload) {
                    throw new Error('Payload n√£o encontrado');
                }
                
                if (!['edit', 'register'].includes(payload.action)) {
                    throw new Error('A√ß√£o inv√°lida. Deve ser "edit" ou "register"');
                }
                
                if (!payload.exp || !payload.iat) {
                    throw new Error('Timestamps de expira√ß√£o n√£o encontrados');
                }
                
                // Verificar expira√ß√£o
                const now = Math.floor(Date.now() / 1000);
                if (payload.exp < now) {
                    throw new Error('Token expirado');
                }
                
                // Token v√°lido
                let clientInfo = '';
                if (payload.action === 'edit' && payload.clientId === mockClient.id) {
                    clientInfo = `
                        <h4>Cliente encontrado:</h4>
                        <p><strong>Nome:</strong> ${mockClient.name}</p>
                        <p><strong>Telefone:</strong> ${mockClient.phone}</p>
                        <p><strong>Email:</strong> ${mockClient.email}</p>
                    `;
                }
                
                showResult(`
                    <h3>‚úÖ Token QR V√°lido!</h3>
                    <p><strong>A√ß√£o:</strong> ${payload.action === 'edit' ? 'Editar Cliente' : 'Registrar Cliente'}</p>
                    <p><strong>Cliente ID:</strong> ${payload.clientId}</p>
                    <p><strong>Expira em:</strong> ${new Date(payload.exp * 1000).toLocaleString('pt-BR')}</p>
                    ${clientInfo}
                `, 'success');
                
            } catch (error) {
                showResult(`
                    <h3>‚ùå Erro na valida√ß√£o</h3>
                    <p>${error.message}</p>
                `, 'error');
            }
        }
        
        function showResult(message, type) {
            const resultDiv = document.getElementById('validation-result');
            resultDiv.className = `result-box result-${type}`;
            resultDiv.innerHTML = message;
            resultDiv.style.display = 'block';
        }
        
        function useExample(type) {
            const payload = {
                clientId: type === 'edit' ? mockClient.id : 'new-client-uuid',
                action: type,
                exp: Math.floor(Date.now() / 1000) + 3600,
                iat: Math.floor(Date.now() / 1000)
            };
            
            const signature = 'example_signature_' + Math.random().toString(36).substring(7);
            const tokenData = { payload: payload, signature: signature };
            const token = btoa(JSON.stringify(tokenData));
            
            document.getElementById('qr-input').value = token;
            validateQRDemo();
        }
        
        function copyToClipboard() {
            const tokenArea = document.getElementById('qr-token-area');
            tokenArea.select();
            document.execCommand('copy');
            
            // Feedback visual
            const btn = event.target;
            const originalText = btn.textContent;
            btn.textContent = '‚úÖ Copiado!';
            btn.style.background = '#27ae60';
            
            setTimeout(() => {
                btn.textContent = originalText;
                btn.style.background = '#3498db';
            }, 2000);
        }
        
        function showTab(tabId) {
            // Esconder todos os conte√∫dos
            document.querySelectorAll('.code-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Remover classe ativa de todas as abas
            document.querySelectorAll('.code-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Mostrar conte√∫do selecionado
            document.getElementById(tabId).classList.add('active');
            
            // Ativar aba selecionada
            event.target.classList.add('active');
        }
        
        // Animar n√∫meros das estat√≠sticas
        function animateStats() {
            const stats = [
                { id: 'demo-atendimentos', target: 12 },
                { id: 'demo-os-pending', target: 8 },
                { id: 'demo-os-signed', target: 5 },
                { id: 'demo-os-finalized', target: 23 }
            ];
            
            stats.forEach(stat => {
                const element = document.getElementById(stat.id);
                let current = 0;
                const increment = stat.target / 30;
                
                const timer = setInterval(() => {
                    current += increment;
                    element.textContent = Math.floor(current);
                    
                    if (current >= stat.target) {
                        element.textContent = stat.target;
                        clearInterval(timer);
                    }
                }, 50);
            });
        }
        
        // Inicializar demonstra√ß√£o quando p√°gina carregar
        document.addEventListener('DOMContentLoaded', () => {
            animateStats();
        });
    </script>
</body>
</html>